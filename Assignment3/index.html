<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>URL-shortener</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<link href="css/templatemo_style.css" rel="stylesheet" type="text/css" />
<script language="javascript" type="text/javascript">
function clearText(field)
{
    if (field.defaultValue == field.value) field.value = '';
    else if (field.value == '') field.value = field.defaultValue;
}
</script>
</head>
<body>
<script type="text/javascript">
    var jwt = ""
</script>
<div id="templatemo_body_wrapper">
<div id="templatemo_wrapper">
    
    <div id="templatemo_header">
            
        <div id="site_title">
            <a href="index.html">
            	<span>URL</span>
            	 Shortener
                <span class="tagline">Group-5</span>
            </a>
        </div> <!-- end of site_title -->
        <div class="cleaner"></div>
        
    </div> <!-- end of header -->
    
    <div id="templatemo_menu">
        <ul>
            <li><a href="index.html" class="current"><span></span>Home</a></li>
            <li><a href="login.html"><span></span>Shortener</a></li>
            <li><a href="details.html"><span></span>Manage URLs</a></li>
        </ul>    	
        
    </div> <!-- end of templatemo_menu -->
    
    <div id="templatemo_main">
    	
        <div id="templatemo_content">
            <script type="text/javascript">
                var retrieve_req = new XMLHttpRequest()
                function retrieve_short() {
                    var short_url = document.getElementById("get_short_url").value
                    retrieve_req.open("GET", "http://127.0.0.1:5000/main/" + short_url, false)
                    retrieve_req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
                    retrieve_req.send()
                    var long_urls = JSON.parse(retrieve_req.response)
                    if (long_urls.length > 1) {
                        alert("This shortened URL are mapping to multiple longer URLs!\n\n" + long_urls)
                    }
                    else {
                        alert(long_urls)
                    }
                }
            </script>
        	<div class="post_box">
                <h2>Input a shortened URL</h2>		
                <div style="text-align: center; padding-top: 40px; padding-bottom: 40px;">
                    <form action="localhost:5001" method="get">
                        <input type="text" id="get_short_url"/>
                        <button style="text-align: justify; padding-left: 10px;" onclick="retrieve_short()">GO</button>
                    </form>
                </div>
              <div class="cleaner"></div>
            </div>
            <div class="post_box">
                <div id="no_jwt" style="display: none;">
                    <script type="text/javascript">
                        var req = new XMLHttpRequest()
                        function login() {
                            userinfo = {
                                "username": document.getElementById("uid").value,
                                "password": document.getElementById("psw").value
                            }
                            req.open("POST", "http://127.0.0.1:5000/auth/users/login", false)
                            req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
                            var payload = "username=" + document.getElementById("uid").value + "&password=" + document.getElementById("psw").value
                            req.send(payload)
                            jwt = req.responseText
                            code = req.status
                            console.log(code)
                            if (code != 200) {
                                alert("Incorrect username or password")
                            }
                            else {
                                document.getElementById("no_jwt").style.display="none"
                                document.getElementById("jwt").style.display=""
                            }
                        }
                    </script>
                    <p align="justify">You need login to use features below <button type="button" onclick="dianwo()">GO>>></button>
                    <div class="zhezhao" id='zhezhao'>
                    <div class="tankuang">
                    <div id="header">
                        <p style="text-align: justify; padding-top: 20px; padding-left: 20px;">Username: <input type="text" id="uid"/></p>
                        <p style="text-align: justify; padding-top: 20px; padding-left: 20px;">Password: <input type="password" id="psw" /></p>
                        <p style="text-align: justify; padding-top: 20px; padding-left: 20px;">
                            <button type="button" onclick="login()">Login</button>
                            <a href="create_account.html" style="text-align: justify; padding-left: 20px">New account</a>
                        </p>
                        <div id="header-right">
                            <p style="text-align: justify; padding-top: 20px; padding-left: 20px;"><button onclick="hidder()">Cancel</button></p>
                        </div>
                    </div>
                    </div>
                    </div>
                </div>
                <div id="jwt" style="display: none;">
                    <p align="justify" onclick="logout()">Logout</p>
                </div>
                <script type="text/javascript">
                    if (jwt == "") {
                        document.getElementById("no_jwt").style.display=""
                        document.getElementById("jwt").style.display="none"
                    }
                    function logout() {
                        jwt = ""
                        document.getElementById("no_jwt").style.display=""
                        document.getElementById("jwt").style.display="none"
                    }
                </script>
                <script type="text/javascript">
                 document.getElementById('zhezhao').style.display="none";
                 function dianwo(){
                  document.getElementById('zhezhao').style.display="";
                 }
                 function hidder(){
                  document.getElementById('zhezhao').style.display="none";
                 }
                </script></p>
            </div>
            <div class="post_box">
                <h2>Create a short URL</h2>		
                <div style="text-align: center; padding-top: 40px; padding-bottom: 40px;">
                    <script type="text/javascript">
                        var post_req = new XMLHttpRequest()
                        function post_long() {
                            var long_url = document.getElementById("post_long_url").value
                            post_req.open("POST", "http://127.0.0.1:5000/main/", false)
                            post_req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
                            token = "Bearer" + " " + JSON.parse(jwt)
                            console.log(token)
                            post_req.setRequestHeader("Authorization", token)
                            payload = "url=" + long_url
                            post_req.send(payload)
                            var short_url = post_req.responseText
                            if (post_req.status == 201) {
                                alert("URL shortened!\n\n" + short_url)
                            }
                            else {
                                alert("Failed to shorten the URL")
                            }
                        }
                    </script>
                    <form>
                        <input type="text" id="post_long_url"/>
                        <button style="text-align: justify; padding-left: 10px;" onclick="post_long()">Create</button>
                    </form>
                </div>
                
                <div class="cleaner"></div>
            </div>

            
            
           <div class="post_box">
                <h2>Manage URLs</h2>
                <div style="text-align: center; padding-top: 40px; padding-bottom: 40px;">
                    <form action="localhost:5001" method="put">
                        <p>Short URL: <input type="text" name="short" id="short_url"/></p>
                        <p>Long URL: <input type="text" name="long" id="new_long_url" /></p>
                        <p><input type="submit" value="Modify"/></p>
                    </form>
                </div>
                <div class="cleaner"></div>
          </div>

          <div class="post_box pb_last">
            
            <h2>Delete URLs</h2>		
            <div style="text-align: center; padding-top: 40px; padding-bottom: 40px;">
                <div style="text-align: center; padding-top: 40px; padding-bottom: 40px;"></div>
                <form action="delete">
                    <p><input type="text" name="short" id="short_url_delete"/><input type="submit" value="Delete short URL" /></p>
                </form>
                <form action="delete">
                    <input type="submit" value="Delete all" />
                </form>
            </div>
         <div class="cleaner"></div>
        </div>
        </div>
    	<div class="cleaner"></div>
    </div>
    
</div>
<div class="cleaner"></div>
</div>


<div id="templatemo_footer_wrapper">
	<div id="templatemo_footer">
		<div>
    		 
		</div>
    	<div class="cleaner"></div>
    </div>
</div>

</body>
</html>